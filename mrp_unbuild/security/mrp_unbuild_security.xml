<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================ -->
    <!-- GRUPOS DE SEGURIDAD -->
    <!-- ============================================ -->
    
    <!-- Grupo para usuarios de Desposte -->
    <record id="group_mrp_unbuild_user" model="res.groups">
        <field name="name">Unbuild User</field>
        <field name="category_id" ref="base.module_category_manufacturing_manufacturing"/>
        <field name="implied_ids" eval="[(4, ref('mrp.group_mrp_user'))]"/>
        <field name="comment">User can create and process unbuild orders</field>
    </record>
    
    <!-- Grupo para managers de Desposte -->
    <record id="group_mrp_unbuild_manager" model="res.groups">
        <field name="name">Unbuild Manager</field>
        <field name="category_id" ref="base.module_category_manufacturing_manufacturing"/>
        <field name="implied_ids" eval="[(4, ref('group_mrp_unbuild_user')), (4, ref('mrp.group_mrp_manager'))]"/>
        <field name="comment">Full access to unbuild configuration and analysis</field>
    </record>
    
    <!-- ============================================ -->
    <!-- REGLAS DE REGISTRO (RECORD RULES) -->
    <!-- ============================================ -->
    
    <!-- Regla para BOMs de tipo unbuild - usuarios solo ven los de su compañía -->
    <record id="mrp_bom_unbuild_company_rule" model="ir.rule">
        <field name="name">Unbuild BoM: multi-company</field>
        <field name="model_id" ref="mrp.model_mrp_bom"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[
            '|',
                ('company_id', '=', False),
                ('company_id', 'in', company_ids),
            ('type', '=', 'unbuild')
        ]</field>
    </record>
    
    <!-- Regla para órdenes de desposte - usuarios solo ven las de su compañía -->
    <record id="mrp_production_unbuild_company_rule" model="ir.rule">
        <field name="name">Unbuild Order: multi-company</field>
        <field name="model_id" ref="mrp.model_mrp_production"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[
            ('company_id', 'in', company_ids),
            ('is_unbuild_order', '=', True)
        ]</field>
    </record>
    
    <!-- Regla para yield lines - usuarios solo ven las de su compañía -->
    <record id="mrp_production_unbuild_yield_company_rule" model="ir.rule">
        <field name="name">Unbuild Yield: multi-company</field>
        <field name="model_id" ref="model_mrp_production_unbuild_yield"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[
            '|',
                ('production_id', '=', False),
                ('production_id.company_id', 'in', company_ids)
        ]</field>
    </record>
    
    <!-- ============================================ -->
    <!-- CATEGORÍAS DE ACCESO -->
    <!-- ============================================ -->
    
    <!-- Categoría para permisos de desposte -->
    <record id="module_category_mrp_unbuild" model="ir.module.category">
        <field name="name">Manufacturing - Unbuild</field>
        <field name="description">Manage unbuild/disassembly operations</field>
        <field name="parent_id" ref="base.module_category_manufacturing_manufacturing"/>
        <field name="sequence">15</field>
    </record>
</odoo>