<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- ============================================ -->
        <!-- SECUENCIAS -->
        <!-- ============================================ -->
        
        <!-- Secuencia para órdenes de desposte -->
        <record id="seq_mrp_unbuild_production" model="ir.sequence">
            <field name="name">Unbuild Order</field>
            <field name="code">mrp.production.unbuild</field>
            <field name="prefix">UO/</field>
            <field name="padding">5</field>
            <field name="company_id" eval="False"/>
        </record>
        
        <!-- ============================================ -->
        <!-- TIPOS DE OPERACIÓN (PICKING TYPES) -->
        <!-- ============================================ -->
        
        <!-- Tipo de operación para desposte - se crea uno por cada warehouse -->
        <function model="stock.warehouse" name="search">
            <value eval="[('company_id', '=', obj().env.company.id)]"/>
            <function name="create_unbuild_picking_type" eval="True"/>
        </function>
        
        <!-- ============================================ -->
        <!-- RUTAS Y REGLAS -->
        <!-- ============================================ -->
        
        <!-- Ruta para desposte -->
        <record id="route_unbuild" model="stock.route">
            <field name="name">Unbuild</field>
            <field name="active" eval="False"/>
            <field name="product_selectable" eval="False"/>
            <field name="warehouse_selectable" eval="True"/>
            <field name="warehouse_ids" eval="[(6, 0, [])]"/>
            <field name="company_id" eval="False"/>
            <field name="sequence">20</field>
        </record>
        
        <!-- ============================================ -->
        <!-- CATEGORÍAS DE PRODUCTOS PARA DESPOSTE -->
        <!-- ============================================ -->
        
        <!-- Categoría para productos de desposte -->
        <record id="product_category_unbuild" model="product.category">
            <field name="name">Unbuild Products</field>
            <field name="parent_id" ref="product.product_category_all"/>
        </record>
        
        <!-- Categoría para subproductos -->
        <record id="product_category_unbuild_output" model="product.category">
            <field name="name">Unbuild Outputs</field>
            <field name="parent_id" ref="product_category_unbuild"/>
        </record>
        
        <!-- Categoría para desperdicios -->
        <record id="product_category_unbuild_waste" model="product.category">
            <field name="name">Unbuild Waste</field>
            <field name="parent_id" ref="product_category_unbuild"/>
        </record>
        
        <!-- ============================================ -->
        <!-- UBICACIONES DE INVENTARIO -->
        <!-- ============================================ -->
        
        <!-- Ubicación virtual para pérdidas de desposte -->
        <record id="location_unbuild_loss" model="stock.location">
            <field name="name">Unbuild Loss</field>
            <field name="usage">inventory</field>
            <field name="location_id" ref="stock.stock_location_locations_virtual"/>
            <field name="company_id" eval="False"/>
            <field name="active" eval="True"/>
            <field name="comment">Virtual location for unbuild process losses</field>
        </record>
        
        <!-- ============================================ -->
        <!-- PARÁMETROS DE CONFIGURACIÓN -->
        <!-- ============================================ -->
        
        <!-- Parámetro para control de rendimientos -->
        <record id="config_parameter_unbuild_strict_yields" model="ir.config_parameter">
            <field name="key">mrp.unbuild.strict_yields</field>
            <field name="value">False</field>
        </record>
        
        <!-- Parámetro para permitir backorders en desposte -->
        <record id="config_parameter_unbuild_allow_backorder" model="ir.config_parameter">
            <field name="key">mrp.unbuild.allow_backorder</field>
            <field name="value">True</field>
        </record>
    </data>
    
    <data>
        <!-- ============================================ -->
        <!-- VISTAS DE CONFIGURACIÓN -->
        <!-- ============================================ -->
        
        <!-- Agregar campos de configuración en settings -->
        <record id="res_config_settings_view_form_unbuild" model="ir.ui.view">
            <field name="name">res.config.settings.view.form.inherit.mrp.unbuild</field>
            <field name="model">res.config.settings</field>
            <field name="inherit_id" ref="mrp.res_config_settings_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@id='planning']" position="after">
                    <h2>Unbuild Settings</h2>
                    <div class="row mt16 o_settings_container" name="unbuild_settings">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="group_unbuild_strict_yields"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="group_unbuild_strict_yields"/>
                                <div class="text-muted">
                                    Enforce strict yield validation in unbuild orders
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="unbuild_allow_backorder"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="unbuild_allow_backorder"/>
                                <div class="text-muted">
                                    Allow creating backorders for unbuild operations
                                </div>
                            </div>
                        </div>
                    </div>
                </xpath>
            </field>
        </record>
    </data>
</odoo>